---
- name: Set system hostname
  ansible.builtin.hostname:
    name: "{{ inventory_hostname }}"

- name: Run system updates
  ansible.builtin.dnf:
    name: "*"
    state: latest

- name: Install essential packages
  ansible.builtin.dnf:
    name: "{{ item }}"
    state: present
  loop:
    - nano
    - git
    - rsync

- name: Disable SSH password authentication
  ansible.builtin.lineinfile:
    path: /etc/ssh/sshd_config
    regexp: '^#?\s*PasswordAuthentication'
    line: 'PasswordAuthentication no'
    backup: yes
    validate: '/usr/sbin/sshd -T -f %s'

- name: Disable empty-password logins
  ansible.builtin.lineinfile:
    path: /etc/ssh/sshd_config
    regexp: '^#?\s*PermitEmptyPasswords'
    line: 'PermitEmptyPasswords no'
    backup: yes
    validate: '/usr/sbin/sshd -T -f %s'

- name: Restart sshd to apply changes
  ansible.builtin.systemd:
    name: sshd
    state: restarted
    enabled: yes