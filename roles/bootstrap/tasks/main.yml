---
- name: Set system hostname
  ansible.builtin.hostname:
    name: "{{ inventory_hostname }}"

- name: Run system updates
  ansible.builtin.dnf:
    name: "*"
    state: latest

- name: Create a local admin user
  ansible.builtin.user:
    name: admin
    state: present
    groups: wheel
    shell: /bin/bash
    password: "$y$j9T$hpC8/4.uMks.J0.w2OBAb/$rtJ1XKCpjPJvhLVTuDxeFwcllqtmjjR4yzMaZ0sqITD"

- name: Lock the root account
  ansible.builtin.user:
    name: root
    password_lock: true

- name: Disable SSH password authentication
  ansible.builtin.lineinfile:
    path: /etc/ssh/sshd_config
    regexp: '^#?\s*PasswordAuthentication'
    line: 'PasswordAuthentication no'
    backup: yes
    validate: '/usr/sbin/sshd -T -f %s'

- name: Disable empty-password logins
  ansible.builtin.lineinfile:
    path: /etc/ssh/sshd_config
    regexp: '^#?\s*PermitEmptyPasswords'
    line: 'PermitEmptyPasswords no'
    backup: yes
    validate: '/usr/sbin/sshd -T -f %s'

- name: Restart sshd to apply changes
  ansible.builtin.systemd:
    name: sshd
    state: restarted
    enabled: yes